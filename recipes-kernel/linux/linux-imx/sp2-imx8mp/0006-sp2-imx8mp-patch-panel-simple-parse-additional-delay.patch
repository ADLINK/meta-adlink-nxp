From f2bbfbe7eb1ab2d20457d8efc4473aca481fddbe Mon Sep 17 00:00:00 2001
From: "po.cheng" <po.cheng@adlinktech.com>
Date: Fri, 24 Nov 2023 10:47:54 +0800
Subject: [PATCH 06/15] sp2-imx8mp: patch: panel-simple: parse additional
 delays to fine tune panel timing

Signed-off-by: po.cheng <po.cheng@adlinktech.com>
---
 drivers/gpu/drm/panel/panel-simple.c | 19 ++++++++++++++++++-
 1 file changed, 18 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/panel/panel-simple.c b/drivers/gpu/drm/panel/panel-simple.c
index d2a921c74bdd8..ce9c2e0a9575d 100644
--- a/drivers/gpu/drm/panel/panel-simple.c
+++ b/drivers/gpu/drm/panel/panel-simple.c
@@ -568,7 +568,7 @@ static int panel_simple_parse_dt_settings (struct device *dev, struct panel_simp
 {
 	struct device_node *np = dev->of_node;
 	struct panel_desc *pd = (struct panel_desc *)desc;
-	int ret = 0;
+	int ret = 0; /* return -1 to warn override */
 
 	/* if other panel node attributes exists, parse them from device tree, and force override */
 	if (of_property_read_bool(np, "panel-width-mm")) {
@@ -579,6 +579,23 @@ static int panel_simple_parse_dt_settings (struct device *dev, struct panel_simp
 		of_property_read_u32(np, "panel-height-mm", &pd->size.height);
 		ret = -1;
 	}
+	/* optional delays */
+	if (of_property_read_bool(np, "delay-prepare")) {
+		of_property_read_u32(np, "delay-prepare", &pd->delay.prepare);
+		ret = -1;
+	}
+	if (of_property_read_bool(np, "delay-enable")) {
+		of_property_read_u32(np, "delay-enable", &pd->delay.enable);
+		ret = -1;
+	}
+	if (of_property_read_bool(np, "delay-disable")) {
+		of_property_read_u32(np, "delay-disable", &pd->delay.disable);
+		ret = -1;
+	}
+	if (of_property_read_bool(np, "delay-unprepare")) {
+		of_property_read_u32(np, "delay-disable", &pd->delay.unprepare);
+		ret = -1;
+	}
 	if (of_property_read_bool(np, "refresh-rate")) {
 		of_property_read_u32(np, "refresh-rate", &pd->refresh_rate);
 		ret = -1;
-- 
2.25.1

