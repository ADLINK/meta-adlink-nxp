From bb3e56c40f3321f9c97e3a5025307b0f4f382072 Mon Sep 17 00:00:00 2001
From: Viswanathan M <viswanathan.m@adlinktech.com>
Date: Tue, 22 Sep 2020 15:52:26 +0530
Subject: [PATCH 6/7] IMX8QM Changes for Single Channel LVDS

Signed-off-by: Viswanathan M <viswanathan.m@adlinktech.com>
---
 arch/arm64/boot/dts/adlink/Makefile                |  1 +
 .../boot/dts/adlink/adlink-lec-imx8qm-lvds.dts     | 70 ++++++++++++++++++++++
 arch/arm64/boot/dts/adlink/adlink-lec-imx8qm.dtsi  | 54 +----------------
 drivers/gpu/drm/panel/panel-simple.c               | 31 ++++++++++
 4 files changed, 105 insertions(+), 51 deletions(-)
 create mode 100644 arch/arm64/boot/dts/adlink/adlink-lec-imx8qm-lvds.dts

diff --git a/arch/arm64/boot/dts/adlink/Makefile b/arch/arm64/boot/dts/adlink/Makefile
index b66e8d1..9c3515e 100644
--- a/arch/arm64/boot/dts/adlink/Makefile
+++ b/arch/arm64/boot/dts/adlink/Makefile
@@ -1,6 +1,7 @@
 dtb-$(CONFIG_ARCH_LEC_IMX8QM) += adlink-lec-imx8qm.dtb \
 				adlink-lec-imx8qm-hdmi.dtb \
 				adlink-lec-imx8qm-dvi.dtb \
+				adlink-lec-imx8qm-lvds.dtb \
 
 always         := $(dtb-y)
 subdir-y       := $(dts-dirs)
diff --git a/arch/arm64/boot/dts/adlink/adlink-lec-imx8qm-lvds.dts b/arch/arm64/boot/dts/adlink/adlink-lec-imx8qm-lvds.dts
new file mode 100644
index 0000000..7784bed
--- /dev/null
+++ b/arch/arm64/boot/dts/adlink/adlink-lec-imx8qm-lvds.dts
@@ -0,0 +1,70 @@
+/*
+ * Copyright 2017-2018 NXP
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ */
+
+
+#include "adlink-lec-imx8qm.dts"
+
+/ {
+        lvds1_panel {
+                compatible = "hannstar,hsd100ifw1";
+                backlight = <&lvds_backlight0>;
+
+                port {
+                        panel_lvds1_in: endpoint {
+                                remote-endpoint = <&adlink_lvds1_out>;
+                        };
+                };
+        };
+};
+
+
+&ldb1_phy {
+	status = "okay";
+};
+
+&ldb1 {
+	status = "okay";
+
+	lvds-channel@0 {
+		fsl,data-mapping = "jeida";
+		fsl,data-width = <24>;
+		primary;
+		status = "okay";
+
+		display-timings {
+			native-mode = <&timing0>;
+			timing0: hsd100pxn1 {
+				clock-frequency = <65000000>;
+				hactive = <1024>;
+				vactive = <600>;
+				hback-porch = <220>;
+				hfront-porch = <40>;
+				vback-porch = <21>;
+				vfront-porch = <7>;
+				hsync-len = <60>;
+				vsync-len = <10>;
+			};
+		};
+		port@1 {
+                        reg = <1>;
+
+                        adlink_lvds1_out: endpoint {
+                                remote-endpoint = <&panel_lvds1_in>;
+                        };
+                };
+	};
+
+};
+
+
diff --git a/arch/arm64/boot/dts/adlink/adlink-lec-imx8qm.dtsi b/arch/arm64/boot/dts/adlink/adlink-lec-imx8qm.dtsi
index d5e5bb2..44d2b45 100644
--- a/arch/arm64/boot/dts/adlink/adlink-lec-imx8qm.dtsi
+++ b/arch/arm64/boot/dts/adlink/adlink-lec-imx8qm.dtsi
@@ -45,9 +45,6 @@
 		#address-cells = <1>;
 		#size-cells = <0>;
 
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_regulators>;
-
 		reg_can01_en: regulator-can01-gen {
 			compatible = "regulator-fixed";
 			regulator-name = "can01-en";
@@ -133,14 +130,6 @@
 			regulator-max-microvolt = <1800000>;
 		};
 
-		reg_smarc_lcd_vdd: regulator@130 {
-			compatible = "regulator-fixed";
-			reg = <130>;
-			regulator-name = "smarc_lcd_vdd";
-			gpio = <&gpio1 6 GPIO_ACTIVE_HIGH>; /* SMARC LCD_VDD_EN */
-			enable-active-high;
-			regulator-always-on;
-		};
 	};
 
 	sound: sound {
@@ -169,7 +158,6 @@
 		compatible = "pwm-backlight";
 		pwms = <&lvds0_pwm 0 100000 0>;
 
-		enable-gpios = <&gpio3 20 GPIO_ACTIVE_HIGH>;
 		brightness-levels = < 0  1  2  3  4  5  6  7  8  9
 				     10 11 12 13 14 15 16 17 18 19
 				     20 21 22 23 24 25 26 27 28 29
@@ -597,13 +585,6 @@
 		pinctrl_lvds0_pwm0: lvds0pwm0grp {
 			fsl,pins = <
 				SC_P_LVDS0_GPIO00_LVDS0_PWM0_OUT	0x00000020
-				SC_P_ADC_IN2_LSIO_GPIO3_IO20            0x00000020
-			>;
-		};
-
-		pinctrl_regulators: pinctrl_regulators{
-			fsl,pins = <
-				SC_P_LVDS0_I2C0_SCL_LSIO_GPIO1_IO06		0x00000020
 			>;
 		};
 
@@ -1283,44 +1264,15 @@
 		fsl,data-width = <24>;
 		status = "okay";
 
-		port@1 {
-			reg = <1>;
-
-			lvds0_out: endpoint {
-				remote-endpoint = <&it6263_0_in>;
-			};
-		};
-	};
-};
-
-&i2c1_lvds0 {
-	#address-cells = <1>;
-	#size-cells = <0>;
-	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_lvds0_lpi2c1>;
-	clock-frequency = <100000>;
-	status = "okay";
-
-	lvds-to-hdmi-bridge@4c {
-		compatible = "ite,it6263";
-		reg = <0x4c>;
-
-		port {
-			it6263_0_in: endpoint {
-				clock-lanes = <3>;
-				data-lanes = <0 1 2 4>;
-				remote-endpoint = <&lvds0_out>;
-			};
-		};
 	};
 };
 
 &ldb2_phy {
-	status = "okay";
+	status = "disabled";
 };
 
 &ldb2 {
-	status = "okay";
+	status = "disabled";
 
 	lvds-channel@0 {
 		fsl,data-mapping = "jeida";
@@ -1343,7 +1295,7 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_lvds1_lpi2c1>;
 	clock-frequency = <100000>;
-	status = "okay";
+	status = "disabled";
 
 	lvds-to-hdmi-bridge@4c {
 		compatible = "ite,it6263";
diff --git a/drivers/gpu/drm/panel/panel-simple.c b/drivers/gpu/drm/panel/panel-simple.c
index 26c2b7f..9d74d27 100644
--- a/drivers/gpu/drm/panel/panel-simple.c
+++ b/drivers/gpu/drm/panel/panel-simple.c
@@ -1449,6 +1449,34 @@ static const struct panel_desc jdi_tx26d202vm0bwa = {
 	.bus_format = MEDIA_BUS_FMT_RGB888_1X7X4_SPWG,
 };
 
+/*ADLINK Added for Single Channel Hannstar LVDS Support+*/
+static const struct display_timing hannstar_hsd100ifw1_timing = {
+        .pixelclock = { 55000000, 65000000, 75000000 },
+        .hactive = { 1024, 1024, 1024 },
+        .hfront_porch = { 40, 40, 40 },
+        .hback_porch = { 220, 220, 220 },
+        .hsync_len = { 20, 60, 100 },
+        .vactive = { 600, 600, 600 },
+        .vfront_porch = { 8, 8, 8 },
+        .vback_porch = { 24, 24, 24 },
+        .vsync_len = { 24, 24, 24 },
+        .flags = DISPLAY_FLAGS_HSYNC_LOW |
+                 DISPLAY_FLAGS_VSYNC_LOW |
+                 DISPLAY_FLAGS_DE_HIGH |
+                 DISPLAY_FLAGS_PIXDATA_NEGEDGE,
+};
+static const struct panel_desc hannstar_hsd100ifw1 = {
+        .timings = &hannstar_hsd100ifw1_timing,
+        .num_timings = 1,
+        .bpc = 6,
+        .size = {
+                .width = 220,
+                .height = 129,
+        },
+        .bus_format = MEDIA_BUS_FMT_RGB888_1X7X4_SPWG,
+};
+/*ADLINK Added for Single Channel Hannstar LVDS Support-*/
+
 static const struct display_timing koe_tx31d200vm0baa_timing = {
 	.pixelclock = { 39600000, 43200000, 48000000 },
 	.hactive = { 1280, 1280, 1280 },
@@ -2490,6 +2518,9 @@ static const struct of_device_id platform_of_match[] = {
 		.compatible = "jdi,tx26d202vm0bwa",
 		.data = &jdi_tx26d202vm0bwa,
 	}, {
+		.compatible = "hannstar,hsd100ifw1", /*Adlink added for Hannstar Single Channel LVDS Support*/
+		.data = &hannstar_hsd100ifw1,	
+	}, {
 		.compatible = "koe,tx31d200vm0baa",
 		.data = &koe_tx31d200vm0baa,
 	}, {
-- 
2.10.2

