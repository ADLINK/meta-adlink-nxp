From a0f53b2bee8df26f8ccb0779d8c546b32faa8e99 Mon Sep 17 00:00:00 2001
From: Antony <antonyabee.prakashxv@adlinktech.com>
Date: Mon, 15 Jul 2019 18:18:25 +0530
Subject: [PATCH 2/2] Add-dual-display-support

---
 arch/arm64/boot/dts/adlink/Makefile                |   3 +-
 .../dts/adlink/adlink-imx8mq-evk-dual-display.dts  | 137 +++++++++++++++++++++
 2 files changed, 139 insertions(+), 1 deletion(-)
 create mode 100644 arch/arm64/boot/dts/adlink/adlink-imx8mq-evk-dual-display.dts

diff --git a/arch/arm64/boot/dts/adlink/Makefile b/arch/arm64/boot/dts/adlink/Makefile
index 1ae0066..8e1c2fd 100644
--- a/arch/arm64/boot/dts/adlink/Makefile
+++ b/arch/arm64/boot/dts/adlink/Makefile
@@ -8,7 +8,8 @@ dtb-$(CONFIG_ARCH_LEC_IMX8M) += adlink-lec-imx8m.dtb \
 				adlink-imx8mq-evk-lcdif-g185xw01.dtb \
 				adlink-imx8mq-evk-lcdif-hv150ux2.dtb \
 				adlink-imx8mq-evk-lcdif-lm215wf3.dtb \
-				adlink-imx8mq-evk-lcdif-n101bge.dtb
+				adlink-imx8mq-evk-lcdif-n101bge.dtb \
+				adlink-imx8mq-evk-dual-display.dtb
 always		:= $(dtb-y)
 subdir-y	:= $(dts-dirs)
 clean-files	:= *.dtb
diff --git a/arch/arm64/boot/dts/adlink/adlink-imx8mq-evk-dual-display.dts b/arch/arm64/boot/dts/adlink/adlink-imx8mq-evk-dual-display.dts
new file mode 100644
index 0000000..cf64a16
--- /dev/null
+++ b/arch/arm64/boot/dts/adlink/adlink-imx8mq-evk-dual-display.dts
@@ -0,0 +1,137 @@
+/*
+ * Copyright 2017 NXP
+ *
+ * This program is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU General Public License
+ * as published by the Free Software Foundation; either version 2
+ * of the License, or (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ */
+
+#include "adlink-lec-imx8m.dts"
+
+/ {
+	backlight: backlight {
+  	compatible = "pwm-backlight";
+		pwms = <&pwm1 0 1000000 0>;
+		brightness-levels = < 0  1  2  3  4  5  6  7  8  9
+				     10 11 12 13 14 15 16 17 18 19
+				     20 21 22 23 24 25 26 27 28 29
+				     30 31 32 33 34 35 36 37 38 39
+				     40 41 42 43 44 45 46 47 48 49
+				     50 51 52 53 54 55 56 57 58 59
+				     60 61 62 63 64 65 66 67 68 69
+				     70 71 72 73 74 75 76 77 78 79
+				     80 81 82 83 84 85 86 87 88 89
+				     90 91 92 93 94 95 96 97 98 99
+				    100>;
+		default-brightness-level = <80>;
+    status = "okay";
+	};
+};
+
+
+&lcdif {
+	status = "okay";
+	max-res = <1600>, <1200>;
+	port@0 {
+		lcdif_mipi_dsi: mipi-dsi-endpoint {
+			remote-endpoint = <&mipi_dsi_in>;
+		};
+	};
+};
+
+&iomuxc {
+	imx8mq-evk {
+		pinctrl_bridge: typecgrp {
+			fsl,pins = <
+				MX8MQ_IOMUXC_SPDIF_EXT_CLK_GPIO5_IO5	0x16			// LCD_BRI_EN	
+			>;
+		};
+	
+		pinctrl_panel: panelgrp {
+			fsl,pins = <
+				MX8MQ_IOMUXC_GPIO1_IO00_GPIO1_IO0	0x16					// LVDS_BKLT_EN					
+				MX8MQ_IOMUXC_SPDIF_EXT_CLK_GPIO5_IO5	0x16			// LCD_BRI_EN	
+				MX8MQ_IOMUXC_SPDIF_TX_GPIO5_IO3		0x16					// LVDS_VDD_EN
+			>;
+		};
+	
+		pinctrl_pwm1: pwm1grp {
+			fsl,pins = <
+				MX8MQ_IOMUXC_GPIO1_IO01_PWM1_OUT 		0x06				// LVDS_BKLTCTL
+			>;
+		};
+	};
+};
+
+&mipi_dsi_phy {
+	status = "okay";
+};
+
+&mipi_dsi {
+	status = "okay";
+	assigned-clocks = <&clk IMX8MQ_CLK_DSI_PHY_REF>,
+			  <&clk IMX8MQ_CLK_DSI_CORE>,
+			  <&clk IMX8MQ_VIDEO_PLL1_REF_SEL>,
+			  <&clk IMX8MQ_VIDEO_PLL1>;
+	assigned-clock-parents = <&clk IMX8MQ_VIDEO_PLL1_OUT>,
+				 <&clk IMX8MQ_SYS1_PLL_266M>,
+				 <&clk IMX8MQ_CLK_25M>;
+	assigned-clock-rates = <24000000>,
+			       <266000000>,
+			       <0>,
+			       <599999999>;
+	as_bridge;
+	sync-pol = <1>;
+	pwr-delay = <10>;
+
+	port@1 {
+		mipi_dsi_in: endpoint {
+			remote-endpoint = <&lcdif_mipi_dsi>;
+		};
+	};
+};
+
+&mipi_dsi_bridge {
+	status = "okay";
+	
+	panel@0 {
+		reg = <0>;
+    status = "okay";
+    compatible = "inno,n101bge";
+    pinctrl-0 = <&pinctrl_panel>;
+    backlight = <&backlight>;
+    bridge-i2c-bus = <&i2c4>;
+    bridge-info = <3>;
+    bridge-gpios = <&gpio5 5 GPIO_ACTIVE_HIGH>;
+    enable-gpios = <&gpio1 0 GPIO_ACTIVE_HIGH>;      
+   	power-gpios = <&gpio5 3 GPIO_ACTIVE_HIGH>;   
+		dsi-lanes = <4>;
+		panel-width-mm  = <223>;
+		panel-height-mm = <126>;
+
+		port {
+			panel_in: endpoint {
+				remote-endpoint = <&mipi_dsi_bridge_out>;
+			};
+		};
+	};
+
+	port@1 {
+		mipi_dsi_bridge_out: endpoint {
+			remote-endpoint = <&panel_in>;
+		};
+	};
+};
+
+&pwm1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_pwm1>;
+	status = "okay";
+};
+
-- 
2.7.4

