From 2be53c035417d6ac76170b33038769a859465864 Mon Sep 17 00:00:00 2001
From: Antony <antonyabee.prakashxv@adlinktech.com>
Date: Wed, 10 Jul 2019 09:24:54 +0530
Subject: [PATCH 2/2] Add-OV5640-mipi_csi-camera-node-and-pinctrl

---
 arch/arm64/boot/dts/adlink/adlink-lec-imx8m.dts | 125 ++++++++----------------
 1 file changed, 41 insertions(+), 84 deletions(-)

diff --git a/arch/arm64/boot/dts/adlink/adlink-lec-imx8m.dts b/arch/arm64/boot/dts/adlink/adlink-lec-imx8m.dts
index c80c49a..ffc9a1c 100644
--- a/arch/arm64/boot/dts/adlink/adlink-lec-imx8m.dts
+++ b/arch/arm64/boot/dts/adlink/adlink-lec-imx8m.dts
@@ -17,6 +17,7 @@
 
 #include "fsl-imx8mq.dtsi"
 #include <dt-bindings/net/ti-dp83867.h>
+#define csien 1
 #define sdslow 1
 
 / {
@@ -102,21 +103,18 @@
 	pinctrl-names = "default";
 
 	lec-imx8m {
-		pinctrl_csi1_pwn: csi1_pwn_grp {
+		pinctrl_csi1: csi1_pwn_grp {
 			fsl,pins = <
 				MX8MQ_IOMUXC_GPIO1_IO03_GPIO1_IO3		0x19
+                                MX8MQ_IOMUXC_GPIO1_IO06_GPIO1_IO6               0x19
+                                MX8MQ_IOMUXC_GPIO1_IO15_CCMSRCGPCMIX_CLKO2      0x59
 			>;
 		};
-		pinctrl_csi2_pwn: csi2_pwn_grp {
+		pinctrl_csi2: csi2_pwn_grp {
 			fsl,pins = <
 				MX8MQ_IOMUXC_GPIO1_IO05_GPIO1_IO5		0x19
-			>;
-		};
-
-		pinctrl_csi_rst: csi_rst_grp {
-			fsl,pins = <
-				MX8MQ_IOMUXC_GPIO1_IO06_GPIO1_IO6		0x19
-				MX8MQ_IOMUXC_GPIO1_IO15_CCMSRCGPCMIX_CLKO2	0x59
+                                MX8MQ_IOMUXC_GPIO1_IO06_GPIO1_IO6               0x19
+                                MX8MQ_IOMUXC_GPIO1_IO15_CCMSRCGPCMIX_CLKO2      0x59
 			>;
 		};
 
@@ -172,8 +170,8 @@
 
 		pinctrl_i2c4: i2c4grp {
 			fsl,pins = <
-				MX8MQ_IOMUXC_I2C4_SCL_I2C4_SCL			0x4000007f
-				MX8MQ_IOMUXC_I2C4_SDA_I2C4_SDA			0x4000007f
+				MX8MQ_IOMUXC_I2C4_SCL_I2C4_SCL			0x40000067
+				MX8MQ_IOMUXC_I2C4_SDA_I2C4_SDA			0x40000067
 			>;
 		};
 
@@ -472,28 +470,6 @@
 		};
 	};
 
-	ov5640_mipi2: ov5640_mipi2@3c {
-		compatible = "ovti,ov5640_mipi";
-		reg = <0x3c>;
-		status = "okay";
-		pinctrl-names = "default";
-		pinctrl-0 = <&pinctrl_csi2_pwn>, <&pinctrl_csi_rst>;
-		clocks = <&clk IMX8MQ_CLK_CLKO2>;
-		clock-names = "csi_mclk";
-		assigned-clocks = <&clk IMX8MQ_CLK_CLKO2>;
-		assigned-clock-parents = <&clk IMX8MQ_SYS2_PLL_200M>;
-		assigned-clock-rates = <20000000>;
-		csi_id = <1>;
-		pwn-gpios = <&gpio1 5 GPIO_ACTIVE_HIGH>;
-		mclk = <20000000>;
-		mclk_source = <0>;
-		port {
-			ov5640_mipi2_ep: endpoint {
-				remote-endpoint = <&mipi2_sensor_ep>;
-			};
-		};
-	};
-
 };
 
 &i2c2 {
@@ -502,28 +478,6 @@
 	pinctrl-0 = <&pinctrl_i2c2>;
 	status = "okay";
 
-        ov5640_mipi: ov5640_mipi@3c {
-                compatible = "ovti,ov5640_mipi";
-                reg = <0x3c>;
-                status = "okay";
-                pinctrl-names = "default";
-                pinctrl-0 = <&pinctrl_csi1_pwn>;
-                clocks = <&clk IMX8MQ_CLK_CLKO2>;
-                clock-names = "csi_mclk";
-                assigned-clocks = <&clk IMX8MQ_CLK_CLKO2>;
-                assigned-clock-parents = <&clk IMX8MQ_SYS2_PLL_200M>;
-                assigned-clock-rates = <20000000>;
-                csi_id = <0>;
-                pwn-gpios = <&gpio1 3 GPIO_ACTIVE_HIGH>;
-                mclk = <20000000>;
-                mclk_source = <0>;
-                port {
-                        ov5640_mipi1_ep: endpoint {
-                                remote-endpoint = <&mipi1_sensor_ep>;
-                        };
-                };
-        };
-
         sgtl5000: codec@2a {
                 compatible = "fsl,sgtl5000";
                 reg = <0x2a>;
@@ -560,6 +514,36 @@
 
 };
 
+&i2c4 {
+        clock-frequency = <100000>;
+        pinctrl-names = "default";
+        pinctrl-0 = <&pinctrl_i2c4>;
+        status = "okay";
+
+        ov5640_mipi: ov5640_mipi@3c {
+                compatible = "ovti,ov5640_mipi";
+                reg = <0x3c>;
+                status = "okay";
+                pinctrl-names = "default";
+                pinctrl-0 = <&pinctrl_csi1>;
+                clocks = <&clk IMX8MQ_CLK_CLKO2>;
+                clock-names = "csi_mclk";
+                assigned-clocks = <&clk IMX8MQ_CLK_CLKO2>;
+                assigned-clock-parents = <&clk IMX8MQ_SYS2_PLL_200M>;
+                assigned-clock-rates = <20000000>;
+                csi_id = <0>;
+                pwn-gpios = <&gpio1 3 GPIO_ACTIVE_HIGH>;
+                rst-gpios = <&gpio1 6 GPIO_ACTIVE_HIGH>;
+                mclk = <20000000>;
+                mclk_source = <0>;
+                port {
+                        ov5640_mipi1_ep: endpoint {
+                                remote-endpoint = <&mipi1_sensor_ep>;
+                        };
+                };
+        };
+};
+
 &pcie0{
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_pcie0>;
@@ -754,6 +738,7 @@
 	status = "okay";
 };
 
+#if csien
 &csi1_bridge {
 	fsl,mipi-mode;
 	fsl,two-8bit-sensor-mode;
@@ -766,18 +751,6 @@
 	};
 };
 
-&csi2_bridge {
-	fsl,mipi-mode;
-	fsl,two-8bit-sensor-mode;
-	status = "okay";
-
-	port {
-		csi2_ep: endpoint {
-			remote-endpoint = <&csi2_mipi_ep>;
-		};
-	};
-};
-
 &mipi_csi_1 {
 	#address-cells = <1>;
 	#size-cells = <0>;
@@ -793,20 +766,4 @@
 		};
 	};
 };
-
-&mipi_csi_2 {
-	#address-cells = <1>;
-	#size-cells = <0>;
-	status = "okay";
-	port {
-		mipi2_sensor_ep: endpoint1 {
-			remote-endpoint = <&ov5640_mipi2_ep>;
-			data-lanes = <1 2>;
-		};
-
-		csi2_mipi_ep: endpoint2 {
-			remote-endpoint = <&csi2_ep>;
-		};
-	};
-};
-
+#endif
-- 
2.7.4

