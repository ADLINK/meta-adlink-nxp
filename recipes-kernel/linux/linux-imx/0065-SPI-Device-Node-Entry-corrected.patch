From 90fd18d5f2c7e88b47a7b6dd9379c59c32ee4030 Mon Sep 17 00:00:00 2001
From: Dinesh kumar <dineshkumar.varadarajan@ltts.com>
Date: Thu, 28 Nov 2019 15:35:12 +0530
Subject: [PATCH 2/2] SPI Device Node Entry corrected

---
 arch/arm/boot/dts/lec-imx6.dtsi | 77 +++++++++++++++++++++++++++++++++++++----
 1 file changed, 71 insertions(+), 6 deletions(-)

diff --git a/arch/arm/boot/dts/lec-imx6.dtsi b/arch/arm/boot/dts/lec-imx6.dtsi
index 3f8098f..94a81ef 100644
--- a/arch/arm/boot/dts/lec-imx6.dtsi
+++ b/arch/arm/boot/dts/lec-imx6.dtsi
@@ -363,6 +363,7 @@
 				 <&clks IMX6QDL_CLK_PLL2_PFD0_352M>;
 };
 
+#if 0
 #if !CONFIG_I2S_AUDIO
 &ecspi1 {	/* SMARC SPI0 (instead of I2S0) */
 	fsl,spi-num-chipselects = <2>;
@@ -418,6 +419,61 @@
 		m25p,fast-read;
 	};
 };
+#endif
+
+&ecspi2 {	/* SMARC SPI1 */
+	fsl,spi-num-chipselects = <2>;
+	cs-gpios = <&gpio2 27 GPIO_ACTIVE_LOW>, /* SMARC CS0 */
+	           <&gpio2 26 GPIO_ACTIVE_LOW>; /* SMARC CS1 */
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_ecspi2>;
+	status = "okay";
+
+        spidev5:spidev5@5 {
+                status = "okay";
+                compatible = "linux,spidev";
+                spi-max-frequency = <2500000>;
+                reg = <0>;
+        };
+};
+
+
+&ecspi3 {	/* SPI  2*/
+	fsl,spi-num-chipselects = <1>;
+	cs-gpios = <&gpio3 25 GPIO_ACTIVE_LOW>; /* SMARC CS0 */	           
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_ecspi3>;
+	status = "okay";
+
+        spidev6:spidev6@6 {
+                status = "okay";
+                compatible = "linux,spidev";
+                spi-max-frequency = <2500000>;
+                reg = <0>;
+        };
+
+};
+
+&ecspi4 {	/* u-boot SPI */
+	fsl,spi-num-chipselects = <2>;
+	cs-gpios = <&gpio4 24 GPIO_ACTIVE_LOW>, /* SMARC CS0 */	    
+		   <&gpio4 25 GPIO_ACTIVE_LOW>;      
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_ecspi4>;
+	status = "okay";
+
+	flash: m25p80@0 {
+		#address-cells = <1>;
+		#size-cells = <1>;
+		#compatible = "spansion,m25p80", "jedec,spi-nor";		
+		compatible = "mx25l6405d";
+		spi-max-frequency = <40000000>; /* slowest we used was SST25VF032B; i.MX6 provides 60MHz max */
+		reg = <0>;
+		spi-cpol;
+		spi-cpha;	
+	};
+
+};
 
 &fec {
 	pinctrl-names = "default";
@@ -856,7 +912,16 @@
 				MX6QDL_PAD_EIM_D28__ECSPI4_MOSI		0x100b1
 				MX6QDL_PAD_EIM_D21__ECSPI4_SCLK		0x100b1
 				MX6QDL_PAD_EIM_D25__GPIO3_IO25		0x1b0b0 /* CS3 */
+			>;
+		};
 
+		pinctrl_ecspi3: ecspi3grp {
+			fsl,pins = <	/* SMARC SPI2 */
+				MX6QDL_PAD_DISP0_DAT2__ECSPI3_MISO	0x100b1
+				MX6QDL_PAD_DISP0_DAT1__ECSPI3_MOSI	0x100b1
+				MX6QDL_PAD_DISP0_DAT0__ECSPI3_SCLK	0x100b1
+				MX6QDL_PAD_DISP0_DAT3__GPIO4_IO24	0x1b0b0 /* CS0 */
+				MX6QDL_PAD_DISP0_DAT4__GPIO4_IO25	0x1b0b0 /* CS1 */
 			>;
 		};
 
@@ -957,12 +1022,12 @@
 				MX6QDL_PAD_DI0_PIN2__IPU1_DI0_PIN02              0xf1
 				MX6QDL_PAD_DI0_PIN3__IPU1_DI0_PIN03              0xf1
 				MX6QDL_PAD_DI0_PIN4__IPU1_DI0_PIN04        0x80000000
-				MX6QDL_PAD_DISP0_DAT0__IPU1_DISP0_DATA00         0xf1
-				MX6QDL_PAD_DISP0_DAT1__IPU1_DISP0_DATA01         0xf1
-				MX6QDL_PAD_DISP0_DAT2__IPU1_DISP0_DATA02         0xf1
-				MX6QDL_PAD_DISP0_DAT3__IPU1_DISP0_DATA03         0xf1
-				MX6QDL_PAD_DISP0_DAT4__IPU1_DISP0_DATA04         0xf1
-				MX6QDL_PAD_DISP0_DAT5__IPU1_DISP0_DATA05         0xf1
+				//MX6QDL_PAD_DISP0_DAT0__IPU1_DISP0_DATA00         0xf1
+				//MX6QDL_PAD_DISP0_DAT1__IPU1_DISP0_DATA01         0xf1
+				//MX6QDL_PAD_DISP0_DAT2__IPU1_DISP0_DATA02         0xf1
+				//MX6QDL_PAD_DISP0_DAT3__IPU1_DISP0_DATA03         0xf1
+				//MX6QDL_PAD_DISP0_DAT4__IPU1_DISP0_DATA04         0xf1
+				//MX6QDL_PAD_DISP0_DAT5__IPU1_DISP0_DATA05         0xf1
 				MX6QDL_PAD_DISP0_DAT6__IPU1_DISP0_DATA06         0xf1
 				MX6QDL_PAD_DISP0_DAT7__IPU1_DISP0_DATA07         0xf1
 				MX6QDL_PAD_DISP0_DAT8__IPU1_DISP0_DATA08         0xf1
-- 
1.9.1

